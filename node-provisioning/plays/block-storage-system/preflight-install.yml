
- hosts:
    - cp
  become: true
  tasks:
    - name: creating working folder
      file:
        path: /tmp/longhorn
        state: directory

    - name: Install basics
      shell: |
        cd /tmp/longhorn
        CLI_ARCH=amd64
        if [ "$(uname -m)" = "aarch64" ]; then CLI_ARCH=arm64; fi
        
        curl -sSfL -o longhornctl https://github.com/longhorn/cli/releases/download/v1.11.0/longhornctl-linux-${CLI_ARCH}
        chmod +x longhornctl
        ./longhornctl install preflight --kubeconfig=/etc/kubernetes/admin.conf #/root/.kube/config

    - name: Cleaning working dir
      file:
        path: /tmp/longhorn
        state: absent